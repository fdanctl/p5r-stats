{{ define "title" }}Persona 5 Royal - Stats{{ end }}
{{ define "extraCSS"}}
    <link href="/static/css/components/svg.css" rel="stylesheet" />
{{ end }}

{{ define "modalTitle" }}New Activity{{ end }}
{{ define "svgSize" }}16px{{ end }}
{{ define "modalContent"}}
<form>
  <input class="input" type="text" placeholder="Title" name="title" />
  <textarea class="input" placeholder="Description" name="description" rows="5" cols="33" maxlength="200">
  </textarea>
  <div class="flex gap-xs items-center cursor-help" onmouseenter="showNearestTooltip(this)" onmouseleave="hideNearestTooltip(this)">
    <h4>Stats</h4>
    <div class="relative question-mark-container">
      {{ template "questionMarkSVG" . }}
      <div class="tooltip">
        <p>info</p>
        <div></div>
      </div>
    </div>
  </div>
  <div class="flex gap-xs">
    <select class="input" name="stat">
      <option value="" disabled selected hidden>Add stat</option>
      <option value="knowledge">Knowledge</option>
      <option value="guts">Guts</option>
      <option value="proficiency">Proficiency</option>
      <option value="kindness">Kindness</option>
      <option value="charm">Charm</option>
    </select>
    <input class="input" type="number" min="1" max="10" name="points" value="1"/>
  </div>
  <div class="music-note-container">{{ template "musicNoteSVG" . }}</div>
  <button class="btn-primary modal-abs-btn" type="reset">reset</button>
</form>
{{ end }}

{{ define "content" }}
<button onclick="deleteUserData()">Delete</button>
<button onclick="insertAcitivity()">New Activity</button>
<button onclick="modify()">Modify</button>
<h1>{{ .Name }}</h1>
<h3>Stats</h3>
<ul>
  <li>Knowledge: {{ .Stats.Knowledge }}</li>
  <li>Guts: {{.Stats.Guts}}</li>
  <li>Proficiency: {{ .Stats.Proficiency }}</li>
  <li>Kindness: {{ .Stats.Kindness }}</li>
  <li>Charm: {{ .Stats.Charm }}</li>
</ul>
<h3>Log</h3>
<ul>
  {{ range .Activities }}
  <li data-id="{{.Id}}" onclick="remove(this.dataset.id)">
    <div class="flex">
      <p>{{ .Title }}</p>
      <p>{{ .Date }}</p>
    </div>
    <ul>
      {{ range .IncreasedStats }}
      <li>
        <p>{{ .Stat }}</p>
        <p>{{ .Points }}</p>
      </li>
      {{ end }}
    </ul>
  </li>
  {{ end }}
</ul>
{{ template "modal" . }}
<script>
// TODO: .js file
async function remove(id) {
  await fetch(`/activity/${id}`, {
    method: "DELETE",
  });
}

async function deleteUserData() {
  await fetch("/user-data", {
    method: "DELETE",
  });
}

async function insertAcitivity() {
  const mockBody = {
    title: "hello",
    description: "hello2",
    increased_stats: [
      {
        stat: "guts",
        points: 1,
      },
      {
        stat: "proficiency",
        points: 1,
      },
    ],
  };
  await fetch("/activity", {
    method: "POST",
    credentials: "include",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(mockBody),
  });
}

async function modify(id) {
  const mockBody = {
    title: "modTitle",
    // description: "modDesc",
    // increased_stats: [
    //   {
    //     stat: "guts",
    //     points: 10,
    //   },
    //   {
    //     stat: "proficiency",
    //     points: 10,
    //   },
    // ],
    date: "1991-12-21"
  };
  await fetch("/activity/123", {
    method: "POST",
    credentials: "include",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(mockBody),
  });
}

function showNearestTooltip(element) {
  const tooltip = element.getElementsByClassName("tooltip")[0];
  tooltip.classList.add("visible");
}

function hideNearestTooltip(element) {
  const tooltip = element.getElementsByClassName("tooltip")[0];
  tooltip.classList.remove("visible");
}
</script>
{{ end }}
